# プロキシ生成ツール

このプロジェクトは、カードのプロキシ（代替カード）を印刷用PDFとして生成するツールです。  
PyQt5 を用いたGUIにより、画像ファイルの追加・管理、印刷枚数の設定、プレビュー、PDF生成が可能です。  
また、PDF生成時には A4（縦向き）と A3（横向き）のページサイズをUI上で切り替えられ、グリッドレイアウトはページ全体の幅と高さから動的に計算されます。

## 特徴

- **画像の追加と管理**  
  - 複数の画像ファイル（.jpg, .png）を選択してテーブルに追加可能。  
  - ドラッグ＆ドロップにより、ローカルファイルだけでなくWebサイトから直接画像（または画像詳細ページのURL）を取り込めます。  
    - ドロップされたURLが相対パスの場合、指定ドメイン（例: `https://dm.takaratomy.co.jp`）を付与して絶対URLに変換します。  
    - 詳細ページURL（`card/detail/?id=...`）の場合は、サムネイル画像URLに変換して画像としてダウンロードします。  
  - 各画像ごとに印刷枚数（初期値は 1）を個別に設定可能。  
  - テーブル上で不要な画像を選択・削除でき、画像名はファイル名のみ表示、96×96ピクセルのサムネイルも表示されます。  
  - 画像名をダブルクリックすると、選択画像のプレビューウィンドウが表示されます。

- **PDF生成**  
  - ReportLab を用いて、画像をカードサイズに合わせたグリッド状に配置しPDFに出力します。  
  - カードサイズは以下の2種類から選択可能です。  
    - **標準サイズ:** 63.5 mm × 88.9 mm  
    - **任意のサイズ:** ユーザが入力した幅と高さ（単位: mm）を使用  
  - ページサイズは、UIのコンボボックスから A4（縦向き）または A3（横向き）を選択可能です。  
  - グリッドの列数および行数は、ページ全体の幅・高さとカードサイズ（およびカード間の余白）から動的に計算されます。  
    例: A4（210 mm × 297 mm）では、標準サイズの場合約3列×3行（計9枚／ページ）、A3では約6列×3行（計18枚／ページ）となります。  
  - ガイドラインは、カードグリッドの境界線がページ端まで描画され、カードの区切りが明確です。  
  - プレビュー機能で生成前にPDF内容を確認できます。

- **保存機能**  
  - PDF生成時、保存ダイアログに初期ファイル名 "output.pdf" を設定して保存できます。

- **一時ファイルの自動削除**  
  - Webからダウンロードした画像やプレビュー用PDFは、システムの一時ディレクトリに保存され、プログラム終了時に自動で削除されます。

- **UIデザインの工夫**  
  - オプションエリア内に「i」ボタンを右端に配置し、使い方や設定内容の詳細をすぐに確認可能。  
  - ウィンドウの初期サイズは 800×600 に設定。  
  - ドラッグ＆ドロップ時のデバッグ出力で、URLの内容や変換処理を確認できます。

## 必要な環境

- Python 3.x
- [PyQt5](https://pypi.org/project/PyQt5/)
- [ReportLab](https://www.reportlab.com/opensource/)

## インストール

必要なパッケージは以下のコマンドでインストールできます。

```bash
pip install PyQt5 reportlab
```

## 使い方

1. **アプリケーションの起動**  
   ターミナルまたはコマンドプロンプトで以下のコマンドを実行してアプリケーションを起動します。

   ```bash
   python your_script.py
   ```

2. **画像の追加**  
   - 「画像追加」ボタンをクリックして、印刷対象の画像ファイル（.jpg, .png）を選択します。  
   - または、画像をドラッグ＆ドロップで追加します。  
     ※ Webサイトから直接ドラッグした場合、URLが自動変換され、サムネイル画像が取得されます。

3. **印刷枚数の設定**  
   - 各画像ごとに表示されるスピンボックスで印刷枚数を設定します。

4. **画像のプレビュー**  
   - テーブル上の画像名またはサムネイルをダブルクリックすると、選択画像が別ウィンドウでプレビュー表示されます。

5. **ページサイズとカードサイズの設定**  
   - オプションエリア内のコンボボックスから、ページサイズ（A4 または A3）を選択します。  
   - カードサイズの選択肢は「標準サイズ」と「任意のサイズ」です。  
     - **標準サイズ:** 63.5 mm × 88.9 mm  
     - **任意のサイズ:** 選択すると、右側の入力欄に幅と高さ（単位: mm）を入力できます。

6. **プレビューとPDF生成**  
   - 「プレビュー」ボタンで、設定内容に基づいた一時PDFを生成し、既定のPDFビューアで確認できます。  
   - 「生成」ボタンをクリックすると、保存ダイアログが表示され、PDFファイルとして保存されます。  
     初期ファイル名は "output.pdf" です。

## コード構成

- **GUI部分**  
  - PyQt5 を用いて、画像の追加（ファイル選択およびドラッグ＆ドロップ）、削除、印刷枚数設定、画像プレビュー、PDF生成、ページサイズおよびカードサイズの切替を実現。  
  - オプションエリア内に「i」ボタンを配置し、使い方や詳細設定の説明を表示できます。

- **PDF生成部分**  
  - ReportLab を利用し、指定のグリッドレイアウトに従って画像を配置しPDFを生成。  
  - ページサイズに合わせたグリッド（列数・行数）は、ページ全体の幅と高さから動的に計算され、ガイドラインはページ端まで描画されます。

- **ドラッグ＆ドロップ機能**  
  - ローカルファイルはもちろん、Webサイトからドラッグ＆ドロップされたURLも対応。  
  - 相対パスを絶対URLに変換し、詳細ページURLからサムネイル画像URLに変換する処理を実装。  
  - ダウンロード時は User-Agent ヘッダー付きのリクエストで、一時ファイルとして保存します。

- **一時ファイルの自動削除**  
  - Webから取得した画像およびプレビュー用PDFは、プログラム終了時に自動で削除され、不要なファイルが残りません。
```
