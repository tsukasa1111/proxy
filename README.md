# プロキシ生成ツール

このプロジェクトは、カードのプロキシ（代替カード）を印刷用PDFとして生成するツールです。  
PyQt5 を用いたGUIにより、画像ファイルの追加・管理、印刷枚数の設定、プレビュー、PDF生成が可能です。  
また、PDF生成時には A4（縦向き）と A3（横向き）のページサイズをUI上で切り替えられます。

## 特徴

- **画像の追加と管理**  
  - 画像ファイルを複数選択してテーブルに追加可能。
  - ドラッグ＆ドロップにより、ローカルファイルだけでなく、Webサイトから直接画像（または画像の詳細ページのURL）を取り込めます。
    - ドロップされたURLが相対パスの場合は、指定ドメイン（例: `https://dm.takaratomy.co.jp`）を付与して絶対URLに変換します。
    - 詳細ページURL（`card/detail/?id=...`）の場合は、サムネイル画像のURLに変換し、画像としてダウンロードします。
  - 各画像ごとに印刷枚数を個別に設定（初期値は 1）。
  - テーブル上で不要な画像を選択して削除可能。
  - 画像名はファイルパスではなくファイル名のみを表示し、テーブル内にはサムネイル（アイコン）も表示されます。  
    ※ サムネイルは96×96ピクセル、行の高さは110に設定しています。
  - 画像名をダブルクリックすると、選択した画像のプレビューウィンドウが表示されます。

- **PDF生成**  
  - ReportLab を用いて、画像をカードサイズ（63×88mm）に合わせたグリッド状に配置し、PDFに出力します。
  - ページサイズはUIのコンボボックスから A4（縦向き、3列×3行＝9枚／ページ）または A3（横向き、6列×3行＝18枚／ページ）を選択可能です。
  - 画像ごとの印刷枚数設定により、同じ画像を複数枚出力可能。
  - ガイドライン（余白用矩形）を描画し、カードの区切りが明確なレイアウトを実現。
  - プレビュー機能により、生成前にPDF内容を確認できます。

- **保存機能**  
  - PDF生成時、保存ダイアログに初期ファイル名 "output.pdf" を設定しています。

- **一時ファイルの自動削除**  
  - Webサイトからドラッグ＆ドロップでダウンロードした画像ファイルおよびプレビュー用に生成されたPDFは、一時ファイルとしてシステムの一時ディレクトリに保存されます。  
  - プログラム終了時に、これらの一時ファイルは自動で削除されるため、不要なファイルがシステムに残ることはありません。

- **その他の機能**  
  - ウィンドウの初期サイズは 800×600 に設定しており、使いやすいサイズになっています。
  - ドラッグ＆ドロップ時のデバッグ出力により、取り込まれるURLの内容や変換処理を確認できます。

## 必要な環境

- Python 3.x
- [PyQt5](https://pypi.org/project/PyQt5/)
- [ReportLab](https://www.reportlab.com/opensource/)

## インストール

必要なパッケージをpipでインストールします。

```bash
pip install PyQt5 reportlab
```

## 使い方

1. **アプリケーションの起動**  
   ターミナルまたはコマンドプロンプトで以下のコマンドを実行してアプリケーションを起動します。

   ```bash
   python your_script.py
   ```

2. **画像の追加**  
   - 「画像追加」ボタンをクリックして、印刷対象の画像ファイル（.jpg, .png）を選択します。  
   - または、画像をドラッグ＆ドロップで追加できます。  
     ※ Webサイトから直接ドラッグした場合、ドロップされたURLが自動的に変換され、サムネイル画像が取得されます。

3. **印刷枚数の設定**  
   - 各画像ごとに表示されるスピンボックスで印刷枚数を設定します。

4. **画像のプレビュー**  
   - テーブルの画像名（およびサムネイル）をダブルクリックすると、選択した画像が別ウィンドウでプレビュー表示されます。

5. **ページサイズの選択**  
   - 画面上部のコンボボックスから、A4 または A3 のページサイズを選択します。  
     - **A4:** 3列×3行（計9枚／ページ）
     - **A3:** 6列×3行（計18枚／ページ）

6. **プレビューとPDF生成**  
   - 「プレビュー」ボタンで、設定内容に基づいた一時PDFを生成し、既定のPDFビューアで内容を確認できます。
   - 「生成」ボタンを押すと、保存ダイアログが表示され、PDFファイルとして保存されます。  
     初期ファイル名は "output.pdf" です。

## コード構成

- **GUI部分**  
  - PyQt5 を用いて、画像の追加（ファイル選択およびドラッグ＆ドロップ）、削除、印刷枚数の設定、画像プレビュー、PDF生成、ページサイズ切替などを実現しています。

- **PDF生成部分**  
  - ReportLab を使用し、指定したグリッドレイアウト（カードサイズ、余白、ガイドライン）に従って画像を配置し、PDFを生成します。  
  - `create_pdf` 関数内で、ページサイズに応じたレイアウトパラメータが設定されています。

- **ドラッグ＆ドロップ機能**  
  - ローカルファイルはもちろん、Webサイトからドラッグ＆ドロップされたURLについても、相対パス→絶対URL変換および、詳細ページURLからサムネイル画像URLへの変換処理が実装されています。  
  - ダウンロード時にはUser-Agent ヘッダー付きのリクエストを使用し、一時ファイルとして保存されます。

- **一時ファイルの自動削除**  
  - ダウンロードした一時ファイル（Webから取得した画像およびプレビュー用PDF）は、プログラム終了時に自動で削除されるため、不要なファイルが残りません。
